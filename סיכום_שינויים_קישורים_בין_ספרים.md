# סיכום שינויים - קישורים בין ספרים באוצריא

## מטרה
הוספת פונקציונליות שמאפשרת יצירת קישורים בטקסט הספרים שכאשר לוחצים עליהם נפתח ספר אחר בתוכנה.

## קבצים שעודכנו

### 1. `lib/utils/text_manipulation.dart`
**הוספנו פונקציה חדשה:**
```dart
String addBookLinks(String text)
```

**מה הפונקציה עושה:**
- מחפשת מילים מסוימות בטקסט (כמו "בראשית", "שמות", "ברכות")
- הופכת אותן לקישורים HTML עם הפורמט: `<a href="book://שם_הספר">המילה</a>`
- משתמשת ב-RegExp כדי להחליף רק מילים שלמות (לא חלק ממילה)

**רשימת הספרים הנוכחית:**
- חמשת חומשי תורה: בראשית, שמות, ויקרא, במדבר, דברים
- כל מסכתות הש"ס (63 מסכתות):
  - סדר זרעים: ברכות, פאה, דמאי, כלאים, שביעית, תרומות, מעשרות, מעשר שני, חלה, ערלה, בכורים
  - סדר מועד: שבת, עירובין, פסחים, שקלים, יומא, סוכה, ביצה, ראש השנה, תענית, מגילה, מועד קטן, חגיגה
  - סדר נשים: יבמות, כתובות, נדרים, נזיר, סוטה, גיטין, קידושין
  - סדר נזיקין: בבא קמא, בבא מציעא, בבא בתרא, סנהדרין, מכות, שבועות, עדויות, עבודה זרה, אבות, הוריות
  - סדר קדשים: זבחים, מנחות, חולין, בכורות, ערכין, תמורה, כריתות, מעילה, תמיד, קינים
  - סדר טהרות: כלים, אהלות, נגעים, פרה, טהרות, מקואות, נדה, מכשירין, זבים, טבול יום, ידים, עוקצין

### 2. `lib/text_book/view/combined_view/combined_book_screen.dart`
**הוספנו:**

1. **פונקציה לטיפול בקישורים:**
```dart
void _handleBookLink(String? url)
```
- מזהה קישורים שמתחילים ב-`book://`
- פותחת את הספר המתאים בתוכנה

2. **עדכון ה-Html widget:**
- הוספנו `onLinkTap: (url, attributes, element) => _handleBookLink(url)`
- עדכנו את עיבוד הטקסט להשתמש ב-`utils.addBookLinks()`

## איך זה עובד

### קישורים ידניים
ניתן להוסיף בקובץ הטקסט:
```html
<a href="book://ברכות">ברכות</a>
<a href="book://ברכות#דף_ב">ברכות דף ב</a>
<a href="book://ברכות#דף_בא">ברכות דף ב עמוד א</a>
```

### קישורים אוטומטיים
המערכת מזהה אוטומטית:
- שמות מסכתות: "ברכות" → קישור למסכת ברכות
- מסכת עם דף: "ברכות דף ב" → קישור לדף ב במסכת ברכות
- מסכת עם דף ועמוד: "ברכות דף ב עמוד א" → קישור לעמוד א של דף ב

### המרת דפים
המערכת ממירה אותיות עבריות למספרי דפים:
- א = דף 1, ב = דף 2, וכו'
- עמוד א = צד ראשון של הדף
- עמוד ב = צד שני של הדף

## מה חדש בעדכון

### ✅ תמיכה מלאה בכל מסכתות הש"ס
כל 63 מסכתות הש"ס נתמכות כעת, מחולקות לפי 6 סדרים.

### ✅ קישורים לדפים ספציפיים
המערכת מזהה ומטפלת בקישורים כמו:
- "ברכות דף ב"
- "ברכות ב" (קיצור)
- "ברכות דף ב עמוד א"

### ✅ המרה אוטומטית של אותיות עבריות
פונקציה חדשה `_hebrewToNumber` ממירה אותיות עבריות למספרי דפים:
- תומכת בכל האותיות מא' עד ת'
- מטפלת בעמוד א' ועמוד ב'
- מחשבת נכון את מספר הדף באינדקס

## הרחבות עתידיות

### להוסיף עוד ספרים:
עדכן את המפה ב-`addBookLinks`:
```dart
final Map<String, String> bookLinks = {
  // ... המסכתות הקיימות
  'ספר_חדש': 'שם_הספר_במערכת',
};
```

### תמיכה בביטויים נוספים:
ניתן להוסיף זיהוי של:
- "בראשית פרק א פסוק א"
- "רמבם הלכות שבת פרק א"
- קיצורים נפוצים: "ב"ק" → "בבא קמא"

## קובץ בדיקה
נוצר `test_book_links.txt` עם דוגמאות לקישורים ידניים ואוטומטיים לבדיקת הפונקציונליות.

## הערות טכניות
- השינויים תואמים למבנה הקיים של flutter_html
- הפונקציונליות עובדת עם מערכת ה-BLoC הקיימת
- תמיכה מלאה בהגדרות הקיימות (פונט, גודל טקסט וכו')